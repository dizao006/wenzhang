import{m as e,r as a,a as s,c as l,b as t,i as o,o as u,d as c,g as i,e as n,f as r,F as f,s as d,v as m,x as p,X as _,Z as k,C as v,Y as g,W as b,M as h,q as y}from"./index-vCkMVs31.js";import{_ as x}from"./uni-icons.Da4HOIOP.js";import{o as j,r as w}from"./uni-app.es.CgFsQHgy.js";import{u as C}from"./isLogin.NjHcPaSZ.js";import{a as F}from"./http.1boYmU1a.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";const P=I({__name:"feedback",setup(I){const P=e(),L=a(),V=a([]),{checkLogin:z}=C();async function B(){const e=5-V.value.length;m({count:e,success(a){a.tempFilePaths.forEach(((s,l)=>{l<e&&V.value.push({url:s,name:a.tempFiles[l].name})}))}})}async function q(){if(!L.value)return void p({title:"请输入反馈信息",icon:"error"});_();const e=await Promise.all((console.log("imageList.value",V.value),V.value.map((e=>new Promise((async a=>{a((await g.uploadFile({filePath:e.url,cloudPath:e.name})).fileID)}))))));var a;k(),await(a={content:L.value,userId:P.state.userInfo._id,feedBackImageList:e},F({name:"update_feedBack",data:a})),p({title:"反馈成功"}),setTimeout((()=>{v({url:"/pages/self/self"})}),1e3)}return j((async()=>{await z()})),(e,a)=>{const m=o,p=b,_=w(s("uni-icons"),x),k=y,v=h;return u(),l(m,null,{default:t((()=>[c(m,{class:"feedback-title"},{default:t((()=>[i(" 意见反馈： ")])),_:1}),c(m,{class:"feedback-content"},{default:t((()=>[c(p,{class:"feedback-textarea",modelValue:L.value,"onUpdate:modelValue":a[0]||(a[0]=e=>L.value=e),placeholder:"请输入您要反馈的问题"},null,8,["modelValue"])])),_:1}),c(m,{class:"feedback-title"},{default:t((()=>[i(" 反馈图片： ")])),_:1}),c(m,{class:"feedback-image-box"},{default:t((()=>[(u(!0),n(f,null,r(V.value,((e,a)=>(u(),l(m,{class:"feedback-image-item",key:a},{default:t((()=>[c(m,{class:"close-icon",onClick:a=>function(e){V.value=V.value.filter((a=>a.url!==e.url))}(e)},{default:t((()=>[c(_,{type:"closeempty",size:"18",color:"#fff"})])),_:2},1032,["onClick"]),c(m,{class:"image-box"},{default:t((()=>[c(k,{src:e.url,mode:"aspectFill"},null,8,["src"])])),_:2},1024)])),_:2},1024)))),128)),V.value.length<5?(u(),l(m,{key:0,class:"feedback-image-item",onClick:B},{default:t((()=>[c(m,{class:"image-box"},{default:t((()=>[c(_,{type:"plusempty",size:"50",color:"#eee"})])),_:1})])),_:1})):d("",!0)])),_:1}),c(v,{type:"warn",class:"feedback-button",onClick:q},{default:t((()=>[i("提交反馈意见")])),_:1})])),_:1})}}},[["__scopeId","data-v-6a2a5632"]]);export{P as default};
