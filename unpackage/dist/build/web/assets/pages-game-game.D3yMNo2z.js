import{r as e,p as t,ak as s,c as l,b as i,al as a,i as o,o as n,d as r,g as u,t as c,n as h,e as d,f,F as v,s as g,y as m}from"./index-hP099HiM.js";import{_ as y}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=function(e){this.size=e,this.cells=this.empty()};x.prototype={empty:function(){let e=[];for(let t=0;t<this.size;t++){let s=e[t]=[];for(let e=0;e<this.size;e++)s.push(null)}return e},availableCells:function(){let e=[];for(let t=0;t<this.size;t++)for(let s=0;s<this.size;s++)this.cells[t][s]||e.push({x:t,y:s});return e},cellsAvailable:function(){return!!this.availableCells().length},randomAvailableCell:function(){let e=this.availableCells();if(e.length)return e[Math.floor(Math.random()*e.length)]},insertTile:function(e){this.cells[e.x][e.y]=e},cellContent:function(e){return this.withinBounds(e)&&this.cells[e.x][e.y]||null},withinBounds:function(e){return e.x>=0&&e.x<this.size&&e.y>=0&&e.y<this.size},emptyCell:function(e){return!this.cellContent(e)},removeTile:function(e){this.cells[e.x][e.y]=null}};const p=function(e,t){this.x=e.x,this.y=e.y,this.value=t||2,this.previousPosition=null,this.mergedFrom=null};p.prototype={savePosition:function(){this.previousPosition={x:this.x,y:this.y}},updatePosition:function(e){this.x=e.x,this.y=e.y}};const _=function(e){this.size=e,this.initBlockNum=2};_.prototype={setup:function(){return this.grid=new x(this.size),this.score=0,this.over=!1,this.won=!1,this.addStartTile(),this.grid.cells},addStartTile:function(){for(let e=0;e<this.initBlockNum;e++)this.addRandomTiles()},addRandomTiles:function(){if(this.grid.cellsAvailable()){let e=this.grid.randomAvailableCell(),t=Math.random()<.9?2:4,s=new p(e,t);this.grid.insertTile(s)}},restart:function(){return this.setup()},move:function(e){let t,s,l=this,i=this.getVector(e),a=this.buildTraversals(i),o=!1;if(l.prepareTiles(),a.x.forEach((function(e){a.y.forEach((function(a){if(t={x:e,y:a},s=l.grid.cellContent(t),s){let e=l.findFarthestTail(t,i),a=l.grid.cellContent(e.next);if(a&&a.value==s.value&&!a.mergedFrom){let t=new p(e.next,2*s.value);t.mergedFrom=[s,a],l.grid.insertTile(t),l.grid.removeTile(s),s.updatePosition(e.next),l.score+=t.value,2048==t.value&&(l.won=!0)}else l.moveTile(s,e.farthest);l.positionsEqual(t,s)||(o=!0)}}))})),o)return this.addRandomTiles(),this.movesAvailable()||(this.over=!0),this.actuate()},getVector:function(e){return{1:{x:0,y:1},2:{x:1,y:0},3:{x:0,y:-1},4:{x:-1,y:0}}[e]},buildTraversals:function(e){let t={x:[],y:[]};for(let s=0;s<this.size;s++)t.x.push(s),t.y.push(s);return 1==e.x&&(t.x=t.x.reverse()),1==e.y&&(t.y=t.y.reverse()),t},prepareTiles:function(){let e;for(let t=0;t<this.size;t++)for(let s=0;s<this.size;s++)e=this.grid.cells[t][s],e&&(e.mergedFrom=null,e.savePosition())},findFarthestTail:function(e,t){let s;do{s=e,e={x:s.x+t.x,y:s.y+t.y}}while(this.grid.withinBounds(e)&&this.grid.emptyCell(e));return{farthest:s,next:e}},moveTile:function(e,t){this.grid.cells[e.x][e.y]=null,this.grid.cells[t.x][t.y]=e,e.updatePosition(t)},positionsEqual:function(e,t){return e.x==t.x&&e.y==t.y},movesAvailable:function(){return this.grid.cellsAvailable()||this.tileMatchesAvailable()},tileMatchesAvailable:function(){let e,t=this;for(let s=0;s<this.size;s++)for(let l=0;l<this.size;l++)if(e=this.grid.cellContent({x:s,y:l}),e)for(let i=1;i<=4;i++){let a=t.getVector(i),o={x:s+a.x,y:l+a.y},n=t.grid.cellContent(o);if(n&&n.value===e.value)return!0}},actuate:function(){return{grids:this.grid.cells,over:this.over,score:this.score,won:this.won}}};const T=y({setup(){const l=e(0),i=e(0),o=e([]),n=e(0),r=e(0),u=e(0),c=e(0),h=e(!1),d=e(!1),f=e(!1),v=e("游戏结束");let g;t((()=>{g=new _(4),o.value=g.setup(),console.log(o.value,"setup"),i.value=s("highScore")||0}));const m=e=>{e.over&&(v.value="游戏结束"),e.won&&(v.value="恭喜"),o.value=[...e.grids],l.value=e.score,i.value=Math.max(i.value,e.score),d.value=e.won,f.value=e.over};return{score:l,highscore:i,grids:o,dataMsg:v,won:d,over:f,restart:()=>{m({grids:g.restart(),score:0,won:!1,over:!1})},touchStart:e=>{if(h.value=e.touches.length>1,h.value)return;const t=e.touches[0];n.value=t.clientX,r.value=t.clientY},touchMove:e=>{const t=e.touches[0];u.value=t.clientX,c.value=t.clientY},touchEnd:()=>{if(h.value)return;const e=u.value-n.value,t=c.value-r.value,l=Math.abs(e),i=Math.abs(t);if(Math.max(l,i)>10){const o=l>i?e>0?1:3:t>0?2:4,n=g.move(o);if(n){let e=s("highScore")||0;e=Math.max(e,n.score),a("highScore",e),m({grids:n.grids,score:n.score,highScore:e,won:n.won,over:n.over})}}}}}},[["render",function(e,t,s,a,y,x){const p=m,_=o;return n(),l(_,{class:"container"},{default:i((()=>[r(_,{class:"game-body"},{default:i((()=>[r(_,{class:"heading"},{default:i((()=>[r(p,{class:"title"},{default:i((()=>[u("2048")])),_:1}),r(_,{class:"scores-container"},{default:i((()=>[r(_,{class:"score-container"},{default:i((()=>[u(c(a.score),1)])),_:1}),r(_,{class:"best-container"},{default:i((()=>[u(c(a.highscore||0),1)])),_:1})])),_:1})])),_:1}),r(_,{class:"above-game"},{default:i((()=>[r(p,{class:"game-intro"},{default:i((()=>[u("你能拿到2048吗？")])),_:1}),r(p,{class:"restart-button",onClick:a.restart},{default:i((()=>[u("新游戏")])),_:1},8,["onClick"])])),_:1}),r(_,{class:"game-container"},{default:i((()=>[r(_,{class:h(["game-message",a.won?"game-won":""])},{default:i((()=>[r(p,{class:"over-msg"},{default:i((()=>[u(c(a.dataMsg),1)])),_:1}),r(_,{class:"lower"},{default:i((()=>[r(p,{class:"retry-button",onClick:a.restart},{default:i((()=>[u("再试一次")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["class"]),r(_,{class:h(["game-message",a.over?"game-over":""])},{default:i((()=>[r(p,{class:"over-msg"},{default:i((()=>[u(c(a.dataMsg),1)])),_:1}),r(_,{class:"lower"},{default:i((()=>[r(p,{class:"retry-button",onClick:a.restart},{default:i((()=>[u("再试一次")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["class"]),r(_,{class:"grid-container",onTouchstart:a.touchStart,onTouchmove:a.touchMove,onTouchend:a.touchEnd},{default:i((()=>[(n(!0),d(v,null,f(a.grids,(e=>(n(),l(_,{class:"grid-row"},{default:i((()=>[(n(!0),d(v,null,f(e,(e=>(n(),l(_,{class:"grid-cell"},{default:i((()=>[r(_,{class:h(null!=e?"tile tile-"+e.value:"")},{default:i((()=>[e?(n(),l(_,{key:0,class:"tile-inner"},{default:i((()=>[u(c(e.value),1)])),_:2},1024)):g("",!0)])),_:2},1032,["class"])])),_:2},1024)))),256))])),_:2},1024)))),256))])),_:1},8,["onTouchstart","onTouchmove","onTouchend"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-f2c38c96"]]);export{T as default};
