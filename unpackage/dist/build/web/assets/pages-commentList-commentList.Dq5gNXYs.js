import{r as e,m as a,a as t,c as n,b as o,i as s,o as l,e as u,f as i,d as m,F as r,s as c,x as v}from"./index-hP099HiM.js";import{_ as d}from"./uni-load-more.G-kRHN8T.js";import{o as p,a as f,r as _}from"./uni-app.es.NZ0FsMzr.js";import{g as y,_ as g,c as h,u as w}from"./getCommentData.C94YP9E3.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./http.CnX7aEgl.js";const x=j({__name:"commentList",setup(j){const x=e(),C=e([]),D=e(5),I=e(1),S=e("loading"),k=e(!1),M=a(),R=e({});async function J(){let e=await y({articleId:x.value,pageSize:D.value,page:I.value});if(0==e.length)return void(S.value="noMore");let a=JSON.parse(JSON.stringify(C.value));a.push(...e),C.value=a}function N(e){O(),R.value={comment_id:e.comment.comment_id,isRepaly:e.isRepaly},e.comment.repaly_id&&(R.value.repaly_id=e.comment.repaly_id)}function O(){k.value=!k.value}async function T(e){await w({userId:M.state.userInfo._id,articleId:x.value,content:e,...R.value}),v({title:"发布成功"}),O(),R.value={},I.value=1,C.value=[],S.value="loading",await J()}return p((async e=>{x.value=e.id,await J()})),f((()=>{"noMore"!==S.value&&(I.value++,J())})),(e,a)=>{const v=s,p=_(t("uni-load-more"),d),f=_(t("CommentMasker"),g);return l(),n(v,null,{default:o((()=>[(l(!0),u(r,null,i(C.value,(e=>(l(),n(v,{class:"comment-content-cointainer",key:e._id},{default:o((()=>[m(h,{commentData:e,onRepalyComment:N},null,8,["commentData"])])),_:2},1024)))),128)),0===C.value.length||C.value.length>5?(l(),n(p,{key:0,contentText:{contentdown:"上拉加载更多",contentrefresh:"正在加载....",contentnomore:"暂无更多评论"},status:S.value},null,8,["contentText","status"])):c("",!0),m(f,{isshow:k.value,onCloseShow:O,onSendDataComent:T},null,8,["isshow"])])),_:1})}}},[["__scopeId","data-v-0d09510f"]]);export{x as default};
