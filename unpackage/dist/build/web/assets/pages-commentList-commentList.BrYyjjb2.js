import{_ as a,r as e,p as t,q as n,a4 as o,a as l,b as s,c as u,d as i,j as m,o as c,f as r,g as d,e as v,F as p,x as f,z as _}from"./index-VArvefSN.js";import{_ as y}from"./uni-load-more.Bc3nc4_m.js";import{g,_ as h,c as w,u as j}from"./getCommentData.BrHIAfGd.js";import"./http.BhNkKofT.js";const x=a({__name:"commentList",setup(a){const x=e(),C=e([]),D=e(5),I=e(1),S=e("loading"),k=e(!1),M=t(),R=e({});async function z(){let a=await g({articleId:x.value,pageSize:D.value,page:I.value});if(0==a.length)return void(S.value="noMore");let e=JSON.parse(JSON.stringify(C.value));e.push(...a),C.value=e}function F(a){J(),R.value={comment_id:a.comment.comment_id,isRepaly:a.isRepaly},a.comment.repaly_id&&(R.value.repaly_id=a.comment.repaly_id)}function J(){k.value=!k.value}async function N(a){await j({userId:M.state.userInfo._id,articleId:x.value,content:a,...R.value}),_({title:"发布成功"}),J(),R.value={},I.value=1,C.value=[],S.value="loading",await z()}return n((async a=>{x.value=a.id,await z()})),o((()=>{"noMore"!==S.value&&(I.value++,z())})),(a,e)=>{const t=m,n=l(s("uni-load-more"),y),o=l(s("CommentMasker"),h);return c(),u(t,null,{default:i((()=>[(c(!0),r(p,null,d(C.value,(a=>(c(),u(t,{class:"comment-content-cointainer",key:a._id},{default:i((()=>[v(w,{commentData:a,onRepalyComment:F},null,8,["commentData"])])),_:2},1024)))),128)),0===C.value.length||C.value.length>5?(c(),u(n,{key:0,contentText:{contentdown:"上拉加载更多",contentrefresh:"正在加载....",contentnomore:"暂无更多评论"},status:S.value},null,8,["contentText","status"])):f("",!0),v(o,{isshow:k.value,onCloseShow:J,onSendDataComent:N},null,8,["isshow"])])),_:1})}}},[["__scopeId","data-v-0d09510f"]]);export{x as default};
