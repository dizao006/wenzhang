import{r as e,m as a,a as t,c as n,b as o,i as s,o as l,e as u,f as i,F as m,s as r,d as c,x as v}from"./index-vCkMVs31.js";import{_ as d}from"./uni-load-more.BY3nG2Si.js";import{o as p,a as f,r as _}from"./uni-app.es.CgFsQHgy.js";import{g as y,_ as g,u as h,c as w}from"./getCommentData.B-6VHWqR.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./http.1boYmU1a.js";const j=x({__name:"commentList",setup(x){const j=e(),C=e([]),I=e(5),S=e(1),D=e("loading"),k=e(!1),M=a(),R=e({});async function J(){let e=await y({articleId:j.value,pageSize:I.value,page:S.value});if(0==e.length)return void(D.value="noMore");let a=JSON.parse(JSON.stringify(C.value));a.push(...e),C.value=a}function N(e){O(),R.value={comment_id:e.comment.comment_id,isRepaly:e.isRepaly},e.comment.repaly_id&&(R.value.repaly_id=e.comment.repaly_id)}function O(){k.value=!k.value}async function T(e){await h({userId:M.state.userInfo._id,articleId:j.value,content:e,...R.value}),v({title:"发布成功"}),O(),R.value={},S.value=1,C.value=[],D.value="loading",await J()}return p((async e=>{j.value=e.id,await J()})),f((()=>{"noMore"!==D.value&&(S.value++,J())})),(e,a)=>{const v=s,p=_(t("uni-load-more"),d),f=_(t("CommentMasker"),g);return l(),n(v,null,{default:o((()=>[(l(!0),u(m,null,i(C.value,(e=>(l(),n(v,{class:"comment-content-cointainer",key:e._id},{default:o((()=>[c(w,{commentData:e,onRepalyComment:N},null,8,["commentData"])])),_:2},1024)))),128)),0===C.value.length||C.value.length>5?(l(),n(p,{key:0,contentText:{contentdown:"上拉加载更多",contentrefresh:"正在加载....",contentnomore:"暂无更多评论"},status:D.value},null,8,["contentText","status"])):r("",!0),c(f,{isshow:k.value,onCloseShow:O,onSendDataComent:T},null,8,["isshow"])])),_:1})}}},[["__scopeId","data-v-0d09510f"]]);export{j as default};
