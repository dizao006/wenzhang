import{_ as a,p as e,r as t,s as l,aa as s,ab as u,c as o,d as c,j as r,o as n,e as i,h as d,t as v,x as m,z as _,G as f,A as I,ac as p,I as h,a7 as y}from"./index-VArvefSN.js";import{g as b,a as g,t as k,b as x,f as w}from"./getArticleById.D7wKnrr0.js";import{m as j}from"./marked.esm.u4QFxa9w.js";import"./http.BhNkKofT.js";const V=a({__name:"createArtic",setup(a){const V=e(),A=t(""),C=t(""),T=t(""),D=t(!1),L=t(b()),M=t(["前端开发","后端开发","移动开发","职场生活","精彩直播","每日一题"]),B=t(0),G=async()=>{_({title:"自动保存成功",icon:"success"}),await q(),C.value="",A.value="",B.value=0,f({url:"/pages/index/index"})},H=()=>{D.value=!D.value,D.value&&(T.value=j(C.value))},U=a=>{B.value=a.detail.value},q=async()=>{const a={abstractText:C.value.slice(0,20),author:{author_name:V.state.userInfo.author_name,avatar:V.state.userInfo.avatar,id:V.state.userInfo.id,_id:V.state.userInfo._id},browse_count:0,classify:M.value[B.value],collection_count:0,comments_count:0,content:j(C.value),cover:[],create_time:k(),articleId:L.value,userId:V.state.userInfo._id,title:A.value,thumbs_up_count:0,status:"draft",comments:[],mode:"base",tags:[M.value[B.value]]};V.commit("addArticList",a),await x({Drafts:a,id:V.state.userInfo._id,articleId:L.value}),_({title:"保存为草稿成功",icon:"success"}),console.log(V.state)},z=async()=>{if(!A.value||!C.value)return void _({title:"标题或内容不能为空",icon:"error"});const a={abstractText:C.value.slice(0,20),author:{author_name:V.state.userInfo.author_name,avatar:V.state.userInfo.avatar,id:V.state.userInfo.id,_id:V.state.userInfo._id},browse_count:0,classify:M.value[B.value],collection_count:0,comments_count:0,content:j(C.value),cover:[],create_time:k(),articleId:L.value,userId:V.state.userInfo._id,title:A.value,thumbs_up_count:0,status:"published",comments:[],mode:"base",tags:[M.value[B.value]]};V.commit("addArticle",a),await w({Drafts:a,userId:V.state.userInfo._id,articleId:L.value}),_({title:"发布成功",icon:"success"}),C.value="",A.value="",B.value=0};return l((async()=>{const a=s("query");if(a&&a.articleId){L.value=a.articleId;try{const e=await g({articleId:a.articleId});if(0===e.code){const a=e.data;A.value=a.title,C.value=a.content;const t=M.value.indexOf(a.classify);t>-1&&(B.value=t)}}catch(e){console.error("获取文章数据失败:",e)}}})),u((()=>{L.value=b(),C.value="",A.value="",B.value=0})),(a,e)=>{const t=I,l=r,s=p,u=h,_=y;return n(),o(l,{class:"markdown-editor"},{default:c((()=>[i(l,{class:"header"},{default:c((()=>[i(t,{onClick:G},{default:c((()=>[d("返回")])),_:1}),i(t,{onClick:H},{default:c((()=>[d(v(D.value?"编辑":"预览"),1)])),_:1}),i(t,{onClick:q},{default:c((()=>[d("保存")])),_:1}),i(s,{mode:"selector",range:M.value,value:B.value,onChange:U},{default:c((()=>[i(l,{class:"picker"},{default:c((()=>[d(v(M.value[B.value]),1)])),_:1})])),_:1},8,["range","value"]),i(t,{onClick:z},{default:c((()=>[d("发布")])),_:1})])),_:1}),i(u,{type:"text",modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=a=>A.value=a),placeholder:"请输入标题",class:"title-input"},null,8,["modelValue"]),i(l,{class:"line"}),D.value?m("",!0):(n(),o(l,{key:0,class:"mdBjk"},{default:c((()=>[i(_,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=a=>C.value=a),placeholder:"请输入 Markdown 内容",class:"editor-textarea",maxlength:99999},null,8,["modelValue"]),i(l,{class:"word-count"},{default:c((()=>[d("已输入 "+v(C.value.length)+" / "+v(99999)+" 字",1)])),_:1})])),_:1})),D.value?(n(),o(l,{key:1,class:"preview-container",innerHTML:T.value},null,8,["innerHTML"])):m("",!0)])),_:1})}}},[["__scopeId","data-v-757af4a2"]]);export{V as default};
