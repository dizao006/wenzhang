import{m as a,r as e,a as s,c as l,b as t,i as c,o,d as u,g as i,e as n,f,F as d,s as r,v as m,x as p,a6 as _,a7 as k,D as v,Y as b,a5 as g,z as y,q as h}from"./index-DwdDHTgs.js";import{_ as x}from"./uni-icons.DL8JbnSX.js";import{a as w,_ as F,o as I,r as P}from"./uni-app.es.DtYEfKEf.js";import{u as j}from"./isLogin.D9YIoZAy.js";const C=F({__name:"feedback",setup(F){const C=a(),L=e(),z=e([]),{checkLogin:V}=j();async function B(){const a=5-z.value.length;m({count:a,success(e){e.tempFilePaths.forEach(((s,l)=>{l<a&&z.value.push({url:s,name:e.tempFiles[l].name})}))}})}async function D(){if(!L.value)return void p({title:"请输入反馈信息",icon:"error"});_();const a=await Promise.all((console.log("imageList.value",z.value),z.value.map((a=>new Promise((async e=>{e((await b.uploadFile({filePath:a.url,cloudPath:a.name})).fileID)}))))));var e;k(),await(e={content:L.value,userId:C.state.userInfo._id,feedBackImageList:a},w({name:"update_feedBack",data:e})),p({title:"反馈成功"}),setTimeout((()=>{v({url:"/pages/self/self"})}),1e3)}return I((async()=>{await V()})),(a,e)=>{const m=c,p=g,_=P(s("uni-icons"),x),k=h,v=y;return o(),l(m,null,{default:t((()=>[u(m,{class:"feedback-title"},{default:t((()=>[i(" 意见反馈： ")])),_:1}),u(m,{class:"feedback-content"},{default:t((()=>[u(p,{class:"feedback-textarea",modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=a=>L.value=a),placeholder:"请输入您要反馈的问题"},null,8,["modelValue"])])),_:1}),u(m,{class:"feedback-title"},{default:t((()=>[i(" 反馈图片： ")])),_:1}),u(m,{class:"feedback-image-box"},{default:t((()=>[(o(!0),n(d,null,f(z.value,((a,e)=>(o(),l(m,{class:"feedback-image-item",key:e},{default:t((()=>[u(m,{class:"close-icon",onClick:e=>function(a){z.value=z.value.filter((e=>e.url!==a.url))}(a)},{default:t((()=>[u(_,{type:"closeempty",size:"18",color:"#fff"})])),_:2},1032,["onClick"]),u(m,{class:"image-box"},{default:t((()=>[u(k,{src:a.url,mode:"aspectFill"},null,8,["src"])])),_:2},1024)])),_:2},1024)))),128)),z.value.length<5?(o(),l(m,{key:0,class:"feedback-image-item",onClick:B},{default:t((()=>[u(m,{class:"image-box"},{default:t((()=>[u(_,{type:"plusempty",size:"50",color:"#eee"})])),_:1})])),_:1})):r("",!0)])),_:1}),u(v,{type:"warn",class:"feedback-button",onClick:D},{default:t((()=>[i("提交反馈意见")])),_:1})])),_:1})}}},[["__scopeId","data-v-6a2a5632"]]);export{C as default};
