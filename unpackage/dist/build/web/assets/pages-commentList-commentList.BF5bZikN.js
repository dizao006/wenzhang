import{r as a,m as e,a as t,c as n,b as o,i as s,o as l,e as u,f as i,F as m,s as r,d as c,x as d}from"./index-DwdDHTgs.js";import{_ as v}from"./uni-load-more.CK7k2JIr.js";import{_ as p,o as f,b as _,r as y}from"./uni-app.es.DtYEfKEf.js";import{g,_ as h,u as w,c as x}from"./getCommentData.f_QQ-CpS.js";const C=p({__name:"commentList",setup(p){const C=a(),I=a([]),S=a(5),j=a(1),k=a("loading"),D=a(!1),M=e(),R=a({});async function b(){let a=await g({articleId:C.value,pageSize:S.value,page:j.value});if(0==a.length)return void(k.value="noMore");let e=JSON.parse(JSON.stringify(I.value));e.push(...a),I.value=e}function J(a){N(),R.value={comment_id:a.comment.comment_id,isRepaly:a.isRepaly},a.comment.repaly_id&&(R.value.repaly_id=a.comment.repaly_id)}function N(){D.value=!D.value}async function O(a){await w({userId:M.state.userInfo._id,articleId:C.value,content:a,...R.value}),d({title:"发布成功"}),N(),R.value={},j.value=1,I.value=[],k.value="loading",await b()}return f((async a=>{C.value=a.id,await b()})),_((()=>{"noMore"!==k.value&&(j.value++,b())})),(a,e)=>{const d=s,p=y(t("uni-load-more"),v),f=y(t("CommentMasker"),h);return l(),n(d,null,{default:o((()=>[(l(!0),u(m,null,i(I.value,(a=>(l(),n(d,{class:"comment-content-cointainer",key:a._id},{default:o((()=>[c(x,{commentData:a,onRepalyComment:J},null,8,["commentData"])])),_:2},1024)))),128)),0===I.value.length||I.value.length>5?(l(),n(p,{key:0,contentText:{contentdown:"上拉加载更多",contentrefresh:"正在加载....",contentnomore:"暂无更多评论"},status:k.value},null,8,["contentText","status"])):r("",!0),c(f,{isshow:D.value,onCloseShow:N,onSendDataComent:O},null,8,["isshow"])])),_:1})}}},[["__scopeId","data-v-0d09510f"]]);export{C as default};
