import{_ as e,r as t,s,aa as l,c as i,d as a,am as o,j as n,o as r,e as u,h as c,t as h,n as d,f,g as v,F as g,x as m,A as y}from"./index-VArvefSN.js";const x=function(e){this.size=e,this.cells=this.empty()};x.prototype={empty:function(){let e=[];for(let t=0;t<this.size;t++){let s=e[t]=[];for(let e=0;e<this.size;e++)s.push(null)}return e},availableCells:function(){let e=[];for(let t=0;t<this.size;t++)for(let s=0;s<this.size;s++)this.cells[t][s]||e.push({x:t,y:s});return e},cellsAvailable:function(){return!!this.availableCells().length},randomAvailableCell:function(){let e=this.availableCells();if(e.length)return e[Math.floor(Math.random()*e.length)]},insertTile:function(e){this.cells[e.x][e.y]=e},cellContent:function(e){return this.withinBounds(e)&&this.cells[e.x][e.y]||null},withinBounds:function(e){return e.x>=0&&e.x<this.size&&e.y>=0&&e.y<this.size},emptyCell:function(e){return!this.cellContent(e)},removeTile:function(e){this.cells[e.x][e.y]=null}};const p=function(e,t){this.x=e.x,this.y=e.y,this.value=t||2,this.previousPosition=null,this.mergedFrom=null};p.prototype={savePosition:function(){this.previousPosition={x:this.x,y:this.y}},updatePosition:function(e){this.x=e.x,this.y=e.y}};const _=function(e){this.size=e,this.initBlockNum=2};_.prototype={setup:function(){return this.grid=new x(this.size),this.score=0,this.over=!1,this.won=!1,this.addStartTile(),this.grid.cells},addStartTile:function(){for(let e=0;e<this.initBlockNum;e++)this.addRandomTiles()},addRandomTiles:function(){if(this.grid.cellsAvailable()){let e=this.grid.randomAvailableCell(),t=Math.random()<.9?2:4,s=new p(e,t);this.grid.insertTile(s)}},restart:function(){return this.setup()},move:function(e){let t,s,l=this,i=this.getVector(e),a=this.buildTraversals(i),o=!1;if(l.prepareTiles(),a.x.forEach((function(e){a.y.forEach((function(a){if(t={x:e,y:a},s=l.grid.cellContent(t),s){let e=l.findFarthestTail(t,i),a=l.grid.cellContent(e.next);if(a&&a.value==s.value&&!a.mergedFrom){let t=new p(e.next,2*s.value);t.mergedFrom=[s,a],l.grid.insertTile(t),l.grid.removeTile(s),s.updatePosition(e.next),l.score+=t.value,2048==t.value&&(l.won=!0)}else l.moveTile(s,e.farthest);l.positionsEqual(t,s)||(o=!0)}}))})),o)return this.addRandomTiles(),this.movesAvailable()||(this.over=!0),this.actuate()},getVector:function(e){return{1:{x:0,y:1},2:{x:1,y:0},3:{x:0,y:-1},4:{x:-1,y:0}}[e]},buildTraversals:function(e){let t={x:[],y:[]};for(let s=0;s<this.size;s++)t.x.push(s),t.y.push(s);return 1==e.x&&(t.x=t.x.reverse()),1==e.y&&(t.y=t.y.reverse()),t},prepareTiles:function(){let e;for(let t=0;t<this.size;t++)for(let s=0;s<this.size;s++)e=this.grid.cells[t][s],e&&(e.mergedFrom=null,e.savePosition())},findFarthestTail:function(e,t){let s;do{s=e,e={x:s.x+t.x,y:s.y+t.y}}while(this.grid.withinBounds(e)&&this.grid.emptyCell(e));return{farthest:s,next:e}},moveTile:function(e,t){this.grid.cells[e.x][e.y]=null,this.grid.cells[t.x][t.y]=e,e.updatePosition(t)},positionsEqual:function(e,t){return e.x==t.x&&e.y==t.y},movesAvailable:function(){return this.grid.cellsAvailable()||this.tileMatchesAvailable()},tileMatchesAvailable:function(){let e,t=this;for(let s=0;s<this.size;s++)for(let l=0;l<this.size;l++)if(e=this.grid.cellContent({x:s,y:l}),e)for(let i=1;i<=4;i++){let a=t.getVector(i),o={x:s+a.x,y:l+a.y},n=t.grid.cellContent(o);if(n&&n.value===e.value)return!0}},actuate:function(){return{grids:this.grid.cells,over:this.over,score:this.score,won:this.won}}};const T=e({setup(){const e=t(0),i=t(0),a=t([]),n=t(0),r=t(0),u=t(0),c=t(0),h=t(!1),d=t(!1),f=t(!1),v=t("游戏结束");let g;s((()=>{g=new _(4),a.value=g.setup(),console.log(a.value,"setup"),i.value=l("highScore")||0}));const m=t=>{t.over&&(v.value="游戏结束"),t.won&&(v.value="恭喜"),a.value=[...t.grids],e.value=t.score,i.value=Math.max(i.value,t.score),d.value=t.won,f.value=t.over};return{score:e,highscore:i,grids:a,dataMsg:v,won:d,over:f,restart:()=>{m({grids:g.restart(),score:0,won:!1,over:!1})},touchStart:e=>{if(h.value=e.touches.length>1,h.value)return;const t=e.touches[0];n.value=t.clientX,r.value=t.clientY},touchMove:e=>{const t=e.touches[0];u.value=t.clientX,c.value=t.clientY},touchEnd:()=>{if(h.value)return;const e=u.value-n.value,t=c.value-r.value,s=Math.abs(e),i=Math.abs(t);if(Math.max(s,i)>10){const a=s>i?e>0?1:3:t>0?2:4,n=g.move(a);if(n){let e=l("highScore")||0;e=Math.max(e,n.score),o("highScore",e),m({grids:n.grids,score:n.score,highScore:e,won:n.won,over:n.over})}}}}}},[["render",function(e,t,s,l,o,x){const p=y,_=n;return r(),i(_,{class:"container"},{default:a((()=>[u(_,{class:"game-body"},{default:a((()=>[u(_,{class:"heading"},{default:a((()=>[u(p,{class:"title"},{default:a((()=>[c("2048")])),_:1}),u(_,{class:"scores-container"},{default:a((()=>[u(_,{class:"score-container"},{default:a((()=>[c(h(l.score),1)])),_:1}),u(_,{class:"best-container"},{default:a((()=>[c(h(l.highscore||0),1)])),_:1})])),_:1})])),_:1}),u(_,{class:"above-game"},{default:a((()=>[u(p,{class:"game-intro"},{default:a((()=>[c("你能拿到2048吗？")])),_:1}),u(p,{class:"restart-button",onClick:l.restart},{default:a((()=>[c("新游戏")])),_:1},8,["onClick"])])),_:1}),u(_,{class:"game-container"},{default:a((()=>[u(_,{class:d(["game-message",l.won?"game-won":""])},{default:a((()=>[u(p,{class:"over-msg"},{default:a((()=>[c(h(l.dataMsg),1)])),_:1}),u(_,{class:"lower"},{default:a((()=>[u(p,{class:"retry-button",onClick:l.restart},{default:a((()=>[c("再试一次")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["class"]),u(_,{class:d(["game-message",l.over?"game-over":""])},{default:a((()=>[u(p,{class:"over-msg"},{default:a((()=>[c(h(l.dataMsg),1)])),_:1}),u(_,{class:"lower"},{default:a((()=>[u(p,{class:"retry-button",onClick:l.restart},{default:a((()=>[c("再试一次")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["class"]),u(_,{class:"grid-container",onTouchstart:l.touchStart,onTouchmove:l.touchMove,onTouchend:l.touchEnd},{default:a((()=>[(r(!0),f(g,null,v(l.grids,(e=>(r(),i(_,{class:"grid-row"},{default:a((()=>[(r(!0),f(g,null,v(e,(e=>(r(),i(_,{class:"grid-cell"},{default:a((()=>[u(_,{class:d(null!=e?"tile tile-"+e.value:"")},{default:a((()=>[e?(r(),i(_,{key:0,class:"tile-inner"},{default:a((()=>[c(h(e.value),1)])),_:2},1024)):m("",!0)])),_:2},1032,["class"])])),_:2},1024)))),256))])),_:2},1024)))),256))])),_:1},8,["onTouchstart","onTouchmove","onTouchend"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-f2c38c96"]]);export{T as default};
