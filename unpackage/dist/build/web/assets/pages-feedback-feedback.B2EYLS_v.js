import{_ as a,p as e,r as s,q as l,a as t,b as c,c as o,d as u,j as i,o as n,e as f,h as d,f as r,g as m,F as p,x as _,y as k,z as v,a8 as b,a9 as g,G as y,Y as h,a7 as x,v as w,B as j}from"./index-VArvefSN.js";import{_ as F}from"./uni-icons.BPusHlUG.js";import{u as I}from"./isLogin.i1xWMhdH.js";import{a as P}from"./http.BhNkKofT.js";const C=a({__name:"feedback",setup(a){const C=e(),L=s(),z=s([]),{checkLogin:B}=I();async function V(){const a=5-z.value.length;k({count:a,success(e){e.tempFilePaths.forEach(((s,l)=>{l<a&&z.value.push({url:s,name:e.tempFiles[l].name})}))}})}async function D(){if(!L.value)return void v({title:"请输入反馈信息",icon:"error"});b();const a=await Promise.all((console.log("imageList.value",z.value),z.value.map((a=>new Promise((async e=>{e((await h.uploadFile({filePath:a.url,cloudPath:a.name})).fileID)}))))));var e;g(),await(e={content:L.value,userId:C.state.userInfo._id,feedBackImageList:a},P({name:"update_feedBack",data:e})),v({title:"反馈成功"}),setTimeout((()=>{y({url:"/pages/self/self"})}),1e3)}return l((async()=>{await B()})),(a,e)=>{const s=i,l=x,k=t(c("uni-icons"),F),v=w,b=j;return n(),o(s,null,{default:u((()=>[f(s,{class:"feedback-title"},{default:u((()=>[d(" 意见反馈： ")])),_:1}),f(s,{class:"feedback-content"},{default:u((()=>[f(l,{class:"feedback-textarea",modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=a=>L.value=a),placeholder:"请输入您要反馈的问题"},null,8,["modelValue"])])),_:1}),f(s,{class:"feedback-title"},{default:u((()=>[d(" 反馈图片： ")])),_:1}),f(s,{class:"feedback-image-box"},{default:u((()=>[(n(!0),r(p,null,m(z.value,((a,e)=>(n(),o(s,{class:"feedback-image-item",key:e},{default:u((()=>[f(s,{class:"close-icon",onClick:e=>function(a){z.value=z.value.filter((e=>e.url!==a.url))}(a)},{default:u((()=>[f(k,{type:"closeempty",size:"18",color:"#fff"})])),_:2},1032,["onClick"]),f(s,{class:"image-box"},{default:u((()=>[f(v,{src:a.url,mode:"aspectFill"},null,8,["src"])])),_:2},1024)])),_:2},1024)))),128)),z.value.length<5?(n(),o(s,{key:0,class:"feedback-image-item",onClick:V},{default:u((()=>[f(s,{class:"image-box"},{default:u((()=>[f(k,{type:"plusempty",size:"50",color:"#eee"})])),_:1})])),_:1})):_("",!0)])),_:1}),f(b,{type:"warn",class:"feedback-button",onClick:D},{default:u((()=>[d("提交反馈意见")])),_:1})])),_:1})}}},[["__scopeId","data-v-6a2a5632"]]);export{C as default};
